# DOCUMENTATION OF WAW DIALOG XML FORMAT

This file specifies the dialog xml format. The xml files are validated against a schema that can be found [here](../data_spec/dialog_schema.xml).

### Schema specification
- Uses **XSD 1.0**

- WARNING: Some of the elements must be in the specified order as attribute `"maxOccurs"` with value `"unbounded"` of elements inside the <xs:all> tag is not allowed for XSD 1.0 ([XMLSchema](https://www.w3.org/2001/XMLSchema.xsd))\
  _(It is allowed for XSD 1.1 but there is no validation in Python for XSD 1.1 so we have to use XSD 1.0)_

- Instead of `<xs:all>` tag this schema uses `<xs:sequence minOccurs="1" maxOccurs="1">` tag which allows `"unbounded"`
value of `"maxOccurs"` attribute of inside tags.

- `<` and `>` signs have to be replaced with `&lt;` and `&gt;` respectively.

---

## **`<nodes>`**

### Elements

- [`<import>`](#import)
- [`<autogenerate>`](#autogenerate)
- [`<node>`](#node)

### Attributes

- `scope`

### Example

```xml
<nodes>
    <import>dialog/chitchat.xml</import>
    <autogenerate>...</autogenerate>
    <node>...</node>
    <node>...</node>
    <import>dialog/manual.xml</import>
    <node>...</node>
</nodes>
```

---

## **`<import>`**

This tag contains a path to an imported file beginning from the modelset directory. Use slash as a path delimiter. Target should be a valid xml.
All `<node>` from root `<nodes>` of imported file whose condition differs from conditions of nodes we already have are append to the tree.
Context of imported nodes with the same condition as already is in the tree is merged into context of corresponding node, not overwriting already present variables.

### Elements

none

### Attributes

- `scope`

### Example

```xml
<import>dialog/chitchat.xml</import>
```

---

## **`<autogenerate>`**

### Elements
elements depend on type (in fact anything is allowed)

- if `type` = `"abort"`
  - `<message>` - String containing a message that is returned when *abort* intent is detected
- if `type` = `"again"`
  - `<message>` - String containing a message that is returned when *again* intent is detected
- if `type` = `"back"`
  - `<message>` - String containing a message that is returned when *back* intent is detected
- if `type` = `"repeat"`
  - `<attempts>` - Number of attempts before user is returned to the main menu
  - [`<outputs>`](#outputs)
- if `type` = `"generic"`
  - any valid xml structure

### Attributes

- `type` **REQUIRED** - Specifies a type of the autogeneration.\
  Allowed values:

  - `"abort"` - Generates node for returning to the main menu
  - `"again"` - Generates node for repeating last question
  - `"back"` - Generates node for returning to the previous node
  - `"repeat"` - Generates nodes for asking user for input repeatedly until the user attempts are exhausted
  - `"generic"` - Generate everything to each level of dialog (e.g. if you want to generate structure to call agent from everywhere)
- `propagate` - If set to `"true"`, it automatically repeats this node settings in sublevels\
  Allowed values:
  - `"true"` (**Default**)
  - `"false"`
- `on` - Sets whether or not this node is enabled.\
  Allowed values:
  - `"true"` (**Default**)
  - `"false"`
- `scope`

---

## **`<node>`**

### Elements

- [`<condition>`](#condition) (only once)
- [`<type>`](#type-in-node) (only once)
- [`<context>`](#context) (only once)
- [`<output>`](#output) (only once)
- [`<goto>`](#goto) (only once)
- [`<nodes>`](#nodes) (only once)
- [`<handlers>`](#handlers) (only once)
- [`<slots>`](#slots) (only once)
- [`<responses>`](#responses) (only once)
- [`<actions>`](#actions) (only once)
- [`<digress_in>`](#digress_in-digress_out-digress_out_slots) (only once)
- [`<digress_out>`](#digress_in-digress_out-digress_out_slots) (only once)
- [`<digress_out_slots>`](#digress_in-digress_out-digress_out_slots) (only once)
- [`<metadata>`](#metadata) (only once)


### Attributes

- `name` (autogenerated if not specified) - Name of the node. Can only contain letters, numbers and underscores.
- `scope`

### Example

```xml
<node name="Dummy_node1">
  <condition>#INTENT_DUMMY</condition>
  <type>standard</type>
  <context>...</context>
  <output>...</output>
  <goto>...</goto>
  <nodes>...</nodes>
  <handlers>...</handlers>
  <slots>...</slots>
  <responses>...</responses>
  <actions>...</actions>
  <digress_in>returns</digress_in>
</node>
```

---

## **`<outputs>`**
Specifies outputs for repeat nodes. First output is used in first turn, last is used while returning to the main menu.

#### **Notes**:

- If there is not enough outputs for all attempts, the second one from the end is repeated.

### Elements

- [`<output>`](#output)

### Attributes

- `scope`

### Example
```xml
<outputs>
  <output>...</output>
  <output>...</output>
  <output>...</output>
</outputs>
```

---

## **`<condition>`**

It represents a condition under which this node will be used in the conversation. Any combination of intents, entities, context variables, and special conditions is allowed.

Default value: `anything_else` (allows to let the last node as the default node)

#### **Notes**:

- Expressions can be concatenated by "and" or "or" and even brackets are allowed, although the UI does not show them properly.
- `<` and `>` signs have to be replaced with `&lt;` and `&gt;` respectively.
- See [dialog-conditions](https://cloud.ibm.com/docs/services/assistant?topic=assistant-dialog-overview#dialog-overview-conditions) for more information.
- See [expression-language](https://cloud.ibm.com/docs/services/assistant?topic=assistant-expression-language) for accessing global variables.

### Elements

none

### Attributes

- `confidenceThreshold` (NOT IMPLEMENTED YET!)
- `scope`

### Example

```xml
<condition confidenceThreshold="0.78">@song or @artist</condition>
```

---

## **`<type>` in `<node>`**
This tag specifies the type of the node.

### Allowed values

- `"standard"` (**Default**)
- `"event_handler"`
- `"frame"`
- `"slot"`
- `"response_condition"`
- `"folder"`

---

## **`<context>`**

This tag allows adding custom variables.

Default value: `null` (no context)

#### **Notes**:
- Child elements names are taken as variable names and their inside texts as their values. (e. g. `<agentName>Volvord</agentName>` creates the variable named "agentName" with the value "Volvord")
- If an attribute `type` with the value `"number"` is present, the variable is considered as numeric and no '"' are added (e. g. `<attempts type="number">5</attempts>` creates the numeric variable named "attempts" with the value 5)
- If an attribute `type` with the value `"boolean"` is present, the variable is considered as boolean and no '"' are added (e. g. `<filledIn type="boolean">True</filledIn>` creates a boolean value named "filledIn" with the value true)
- To expand variable values inside other variables, glue strings, add numbers, and add items to a list, use expression evaluation in string values of the JSON update structures. See [documentation](https://cloud.ibm.com/docs/services/assistant?topic=assistant-expression-language).
- `<` and `>` signs have to be replaced with `&lt;` and `&gt;` respectively.
- If there are more variables with the same name, both will appear in the output JSON, but service will use only the last of them.

### Elements

any valid xml structure


### Attributes

- `scope`

### Example

```xml
<context>
  <myStringVariable>Hello world!</myStringVariable>
  <myIntVariable type="number">2</myIntVariable>
</context>
```

*This will create variable named "myStringVariable" with the value "Hello world!" and variable named "myIntVariable" with the value 2.*

---

## **`<output>`**

Specifies the dialog output.

#### **Notes**:

- It is possible to add any custom variables as in [`<context>`](#context).
- If tag [`<text>`](#text) is present, it is used as text output in conversation.
- For multiple responses feature use [`<textValues>`](#textValues) tag.

### Elements (in this order)

- [`<text>`](#text) (only once)
- any valid xml structure

or

- [`<textValues>`](#textValues) (only once)
- any valid xml structure

or

- [`<response>`](#response) (only once)
- any valid xml structure

### Attributes

- `scope`

### Example

```xml
<output>
  <text>How are you?</text>
  <speech>Hello, how are you?</speech>
  <someValidTag>...</someValidTag>
</output>
```

or

```xml
<output>
  <textValues>
    ...
  </textValues>
  <someValidTag>...</someValidTag>
</output>
```

or

```xml
<output>
  <response>
    ...
  </response>
  <someValidTag>...</someValidTag>
</output>
```

---

## **`<goto>`**

Represents a jump to another node or to another type of next step.

### Elements (in this order)

- [`<behavior>`](#behavior) **REQUIRED** (only once)
- [`<target>`](#target) (only once)
- [`<selector>`](#selector) (only once)

### Attributes

- `scope`

### Example

```xml
<goto>
  <behavior>jump_to</behavior>
  <target>node_to_go<target>
  <selector>user_input<selector>
</goto>
```

---

## **`<handlers>`**

### Elements

- [`<handler>`](#handler)

### Attributes

- `scope`

### Example

```xml
<handlers>
  <handler>...</handler>
  <handler>...</handler>
  <handler>...</handler>
</handlers>
```

---

## **`<slots>`**

### Elements

- [`<slot>`](#slot)

### Attributes

- `scope`

### Example

```xml
<slots>
  <slot>...</slot>
  <slot>...</slot>
  <slot>...</slot>
</slots>
```

---

## **`<responses>`**

### Elements

- [`<response>`](#response)

### Attributes

- `scope`

### Example

```xml
<responses>
  <response>...</response>
  <response>...</response>
  <response>...</response>
</responses>
```

---

## **`<actions>`**

### Elements

- [`<action>`](#action)

### Attributes

- `scope`

### Example

```xml
<actions>
  <action>...</action>
  <action>...</action>
  <action>...</action>
</actions>
```

---

## **`<digress_in>`, `<digress_out>`, `<digress_out_slots>`**

Specifies digression settings of this node. For more information see [digression tutorial](https://cloud.ibm.com/docs/services/assistant?topic=assistant-tutorial-digressions).

---

## **`<metadata>`**

The metadata for the dialog node.

### Attributes

- `scope`

---

## **`<text>`**

Specifies the output text.\
Default value: empty string `""`

### Attributes

- `scope`

---

## **`<textValues>`**

Enables multiple responses.

### Elements (in this order)

- [`<values>`](#values)
- [`<append>`](#append)
- [`<selection_policy>`](#selection_policy)

### Attributes

- `scope`

### Example

```xml
<textValues>
  <values>Hi.</values>
  <values>Nice to met you.</values>
  <append>false</append>
  <selection_policy>random</selection_policy>
</textValues>
```

#### **Notes**:

- use the attribute `structure="listItem"` for `<values>` if only one item is specified.

  e.g.:

  ```xml
  <textValues>
    <values structure="listItem">This is a single value.</values>
  </textValues>
  ```

---

## **`<behavior>`**

Specifies what should happen after evaluation of this node.

#### Allowed values

- `"jump_to"` (**Default**)
- `"skip_user_input"`
- `"get_user_input"`
- `"reprompt"`
- `"skip_slot"`
- `"skip_all_slots"`

---

## **`<target>`**

Specifies a name of the node where to jump.

#### **Notes**:

- There is a built-in special key `::FIRST_SIBLING` that is replaced by the name of the first sibling of given dialog level.

---

## **`<selector>`**

Specifies where jump action continues processing.

#### Allowed values

- `"user_input"` (**Default**)
- `"condition"`
- `"body"`

---

## **`<handler>`**

### Elements

- [`<condition>`](#condition) (only once)
- [`<context>`](#context) (only once)
- [`<output>`](#output) (only once)

### Attributes

- `eventName` **REQUIRED** - specifies the type of the handled event
- `scope`

### Example

```xml
<handler eventName="input">
  <condition>#HELP</condition>
  <context>...</context>
  <output>...</output>
</handler>
```

---

## **`<slot>`**

### Elements

- [`<handlers>`](#handlers) (only once)

### Attributes

- `variable` **REQUIRED**
- `scope`

### Example

```xml
<slot variable="$destination">
  <handlers>...</handlers>
</slot>
```

---

## **`<response>`**

### Elements

- [`<condition>`](#condition) (only once)
- [`<context>`](#context) (only once)
- [`<output>`](#output) (only once)
- [`<goto>`](#goto) (only once)

### Attributes

- `scope`

### Example

```xml
<response>
  <condition>#HELP</condition>
  <context>...</context>
  <output>...</output>
  <goto>...</goto>
</response>
```

---

## **`<selection_policy>`**

Specifies the type of text value selection for output

### Allowed values

- `"random"` (**Default**)
- `"sequential"`

---

## **`<append>`**

Specifies whether to append a value to an array or overwrite the values in the array with the new value.

### Allowed values

- `"true"` (**Default**)
- `"false"`

---

## **`<action>`**

### Elements

- [`<name>`](#name) **REQUIRED** (only once)
- [`<result_variable>`](#result_variable) **REQUIRED** (only once)
- [`<type>`](#type-in-action) (only once)
- [`<parameters>`](#<parameters) (only once)
- [`<credentials>`](#credentials) (only once)

### Attributes

- `scope`

### Example

```xml
<action>
  <name>name_of_the_action</name>
  <type>cloud_function</type>
  <parameters>
    <arg1>...</arg1>
    <arg2>...</arg2>
  </parameters>
  <result_variable>name_of_my_context_variable</result_variable>
  <credentials>name_of_credentials_variable</credentials>
</action>
```

---

## **`<result_variable>`**

The location in the dialog context where the result of the action is stored.

### Attributes

- `scope`

---

## **`<type>` in `<action>`**

The type of action to invoke.

### Allowed values

- `"client"`
- `"server"`
- `"cloud_function"`
- `"web_action"`

---

## **`<parameters>`**

### Attributes

- `scope`
- `structure`\
  Allowed values:

  - `"listItem"`
  - `"emptyList"`
  - `"emptyDict"`

---

## **`<credentials>`**

The name of the context variable that the client application will use to pass in credentials for the action.

### Attributes

- `scope`